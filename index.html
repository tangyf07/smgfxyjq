import React, { useState } from ‘react’;
import { Sparkles, Heart, Backpack } from ‘lucide-react’;

const TextAdventureGame = () => {
const [currentScene, setCurrentScene] = useState(‘start’);
const [inventory, setInventory] = useState([]);
const [health, setHealth] = useState(100);
const [gameOver, setGameOver] = useState(false);
const [victory, setVictory] = useState(false);

const addToInventory = (item) => {
setInventory([…inventory, item]);
};

const hasItem = (item) => inventory.includes(item);

const changeHealth = (amount) => {
const newHealth = Math.max(0, Math.min(100, health + amount));
setHealth(newHealth);
if (newHealth === 0) {
setGameOver(true);
}
};

const scenes = {
start: {
text: “你醒来时发现自己躺在一片迷雾笼罩的森林中。阳光透过树叶洒下斑驳的光影，远处传来不明的声音。你完全不记得自己是如何来到这里的。\n\n你注意到地上有一个破旧的背包和一根结实的木棍。”,
choices: [
{ text: “拿起背包和木棍”, next: “forest_path”, action: () => { addToInventory(‘木棍’); addToInventory(‘背包’); } },
{ text: “只拿木棍，轻装前行”, next: “forest_path”, action: () => addToInventory(‘木棍’) },
{ text: “什么都不拿，立即探索”, next: “forest_path” }
]
},
forest_path: {
text: “你沿着一条若隐若现的小径前行。迷雾渐渐散去，你看到前方小径分成了三条岔路：\n\n左边的路通向一座古老的石桥，桥下流水潺潺；\n中间的路延伸进更深的密林，树木遮天蔽日；\n右边的路爬上一个小山坡，似乎能看到远处的景色。”,
choices: [
{ text: “走向左边的石桥”, next: “stone_bridge” },
{ text: “进入中间的密林”, next: “deep_forest” },
{ text: “爬上右边的山坡”, next: “hilltop” }
]
},
stone_bridge: {
text: “你来到石桥前。这座桥看起来已有数百年历史，长满了青苔。桥的另一端隐约可见一座小木屋。\n\n正当你准备过桥时，一个苍老的声音从桥下传来："年轻人，想过桥吗？回答我一个问题，或者给我一件宝物。"”,
choices: [
{ text: “回答问题：生命中最重要的是什么？”, next: “bridge_riddle” },
{
text: “把背包给他”,
next: “bridge_gift_check”,
disabled: true
},
{ text: “尝试强行冲过桥”, next: “bridge_force” }
]
},
bridge_riddle: {
text: “老者沉思片刻后笑了："勇气与智慧。很好的答案。"\n\n桥下升起一道金光，一枚古老的钥匙漂浮到你面前。"这把钥匙会在你需要时帮助你。"老者说完便消失了。\n\n你可以安全地过桥了。对岸的木屋门前站着一个神秘的人影。”,
choices: [
{ text: “拿起钥匙，前往木屋”, next: “cabin”, action: () => addToInventory(‘金色钥匙’) },
{ text: “返回岔路口”, next: “forest_path” }
]
},
bridge_gift_check: {
text: “”,
choices: []
},
bridge_gift: {
text: “老者接过背包，满意地点了点头："慷慨之人必有善报。"\n\n他从背包中取出一瓶药水递给你："这是治疗药水，关键时刻会救你一命。"然后消失在桥下。\n\n你可以安全地过桥了。对岸的木屋门前站着一个神秘的人影。”,
choices: [
{ text: “拿起药水，前往木屋”, next: “cabin”, action: () => addToInventory(‘治疗药水’) },
{ text: “返回岔路口”, next: “forest_path” }
]
},
bridge_force: {
text: “你试图冲过桥，但桥突然开始剧烈摇晃！一块石头砸中了你的肩膀。\n\n你勉强冲到了对岸，但受了伤。对岸的木屋门前站着一个神秘的人影。”,
choices: [
{ text: “前往木屋”, next: “cabin”, action: () => changeHealth(-20) },
{ text: “先休息恢复”, next: “rest_bridge”, action: () => changeHealth(-20) }
]
},
rest_bridge: {
text: “你在桥边休息了一会儿，伤势稍有好转。你决定前往木屋。”,
choices: [
{ text: “前往木屋”, next: “cabin”, action: () => changeHealth(10) }
]
},
cabin: {
text: “木屋前站着一位身披斗篷的神秘女子。她看到你后说道："旅行者，我是这片森林的守护者。你要找到森林之心才能离开这里。"\n\n"森林之心被封印在迷雾塔中，但进入塔需要三件圣物：光明之石、智慧卷轴和勇气徽章。我可以给你第一件。"”,
choices: [
{ text: “接受光明之石”, next: “get_stone”, action: () => addToInventory(‘光明之石’) },
{ text: “询问更多信息”, next: “cabin_info” }
]
},
get_stone: {
text: “女子将一颗闪烁着柔和光芒的石头交给你。"其他两件圣物，你需要自己去寻找。智慧卷轴在密林深处的神殿，勇气徽章在山顶的试炼场。"\n\n她指向远方："祝你好运，勇敢的旅行者。"”,
choices: [
{ text: “前往密林神殿”, next: “deep_forest” },
{ text: “前往山顶试炼场”, next: “hilltop” },
{ text: “返回岔路口重新规划”, next: “forest_path” }
]
},
cabin_info: {
text: “女子解释道："这片森林曾经充满生机，但一个黑暗法师偷走了森林之心。只有集齐三件圣物，你才能进入迷雾塔取回它。"\n\n"时间不多了，森林正在逐渐枯萎。"”,
choices: [
{ text: “接受光明之石开始寻找”, next: “get_stone”, action: () => addToInventory(‘光明之石’) }
]
},
deep_forest: {
text: “你进入密林深处，周围越来越暗。”,
choices: []
},
deep_forest_dark: {
text: “密林深处一片漆黑，你什么都看不见。恐惧涌上心头，你只能返回。”,
choices: [
{ text: “返回岔路口”, next: “forest_path” }
]
},
deep_forest_light: {
text: “幸好光明之石散发出柔和的光芒，照亮了前路。\n\n你看到前方有一座半掩埋在藤蔓中的古老神殿。神殿门口刻着古老的文字："智者方可入内。"”,
choices: [
{ text: “进入神殿”, next: “temple” },
{ text: “先探索周围”, next: “temple_explore” }
]
},
temple: {
text: “神殿内部昏暗潮湿，墙上刻满了古老的文字和图案。中央有一个石台，上面放着一个卷轴。\n\n但石台前站着一个石像守卫。它开口说道："要证明你的智慧，解开这个谜题：我不是活的，但我会生长；我没有肺，但我需要空气；我没有嘴，但水会杀死我。我是什么？"”,
choices: [
{ text: “回答：火焰”, next: “temple_correct” },
{ text: “回答：植物”, next: “temple_wrong” },
{ text: “用木棍攻击石像”, next: “temple_fight_check”, disabled: true }
]
},
temple_fight_check: {
text: “”,
choices: []
},
temple_correct: {
text: “石像守卫点头："智慧之人，你可以取走卷轴。"\n\n石像让开了道路，你拿到了智慧卷轴！卷轴上写着古老的咒语和知识。”,
choices: [
{ text: “继续收集圣物”, next: “after_temple”, action: () => addToInventory(‘智慧卷轴’) }
]
},
after_temple: {
text: “你现在拥有了智慧卷轴！”,
choices: []
},
temple_wrong: {
text: “石像守卫摇头："错误。"一道能量波击中了你！\n\n你被震飞出神殿，受了重伤。”,
choices: [
{ text: “使用治疗药水”, next: “temple_heal_check”, disabled: true },
{ text: “忍痛返回”, next: “forest_path”, action: () => changeHealth(-30) }
]
},
temple_heal_check: {
text: “”,
choices: []
},
temple_heal: {
text: “你喝下治疗药水，伤势迅速愈合。你感觉好多了！\n\n你可以重新尝试进入神殿。”,
choices: [
{ text: “再次进入神殿”, next: “temple”, action: () => changeHealth(40) },
{ text: “先去其他地方”, next: “forest_path”, action: () => changeHealth(40) }
]
},
temple_fight: {
text: “你挥舞木棍攻击石像，但石像坚硬如铁！它一拳将你打飞。\n\n你受了重伤，木棍也断了。”,
choices: [
{ text: “逃离神殿”, next: “forest_path”, action: () => changeHealth(-40) }
]
},
temple_explore: {
text: “你在神殿周围探索，发现了一些古老的壁画。壁画描绘了森林的历史和三件圣物的传说。\n\n你获得了一些有用的知识。”,
choices: [
{ text: “进入神殿”, next: “temple” }
]
},
hilltop: {
text: “你爬上山坡，视野豁然开朗。山顶上有一个古老的竞技场，中央立着一块石碑。\n\n石碑上写着："勇者试炼场。证明你的勇气，即可获得勇气徽章。"\n\n突然，一只巨大的石狼从竞技场另一端走出，发出低沉的吼声。”,
choices: [
{ text: “战斗”, next: “wolf_fight_check”, disabled: true },
{ text: “尝试与石狼沟通”, next: “wolf_talk” },
{ text: “逃跑”, next: “forest_path”, action: () => changeHealth(-10) }
]
},
wolf_fight_check: {
text: “”,
choices: []
},
wolf_fight_stick: {
text: “你挥舞木棍与石狼战斗！战斗激烈而危险，你被抓伤了几处，但最终你击败了石狼。\n\n石狼化作光点消散，留下了勇气徽章。你证明了自己的勇气！”,
choices: [
{ text: “继续冒险”, next: “after_wolf”, action: () => { addToInventory(‘勇气徽章’); changeHealth(-20); } }
]
},
wolf_fight_bare: {
text: “你徒手与石狼战斗！虽然英勇，但你受了重伤。幸运的是，石狼认可了你的勇气，主动化作光点，留下了勇气徽章。”,
choices: [
{ text: “继续冒险”, next: “after_wolf”, action: () => { addToInventory(‘勇气徽章’); changeHealth(-35); } }
]
},
after_wolf: {
text: “你获得了勇气徽章！”,
choices: []
},
wolf_talk: {
text: “你放下武器，试图与石狼沟通。石狼停下脚步，用智慧的眼神看着你。\n\n"真正的勇气不是无畏，而是在恐惧中依然选择正确的道路。"石狼说道，然后化作光芒，勇气徽章出现在你面前。\n\n"你通过了试炼。"”,
choices: [
{ text: “继续冒险”, next: “after_wolf”, action: () => addToInventory(‘勇气徽章’) }
]
},
mist_tower: {
text: “你终于集齐了三件圣物！\n\n来到森林中心，一座高耸的迷雾塔出现在眼前。三件圣物开始发光，共鸣着打开了塔门。\n\n你走进塔内，最顶层有一个散发着黑暗气息的法师。他手中握着森林之心——一颗脉搏般跳动的绿色宝石。”,
choices: [
{ text: “用智慧卷轴削弱他的力量”, next: “final_battle_check”, disabled: true },
{ text: “直接发起进攻”, next: “final_battle_direct” }
]
},
final_battle_check: {
text: “”,
choices: []
},
final_battle: {
text: “你念出智慧卷轴上的咒语，黑暗法师的力量被削弱了！光明之石和勇气徽章也发出耀眼的光芒。\n\n"该结束了！"你冲向法师，经过激烈的战斗，你成功夺回了森林之心！\n\n法师消散在空气中，森林之心回到了你手中。外面的森林开始恢复生机，迷雾散去，阳光普照。”,
choices: [
{ text: “完成冒险”, next: “victory”, action: () => setVictory(true) }
]
},
final_battle_key: {
text: “你念出智慧卷轴上的咒语，同时用金色钥匙解开了森林之心上的封印！\n\n黑暗法师发出惊恐的叫声，森林之心自动飞向你。三件圣物和钥匙的力量结合，轻松击败了法师。\n\n森林之心回归，森林瞬间恢复了生机！鸟语花香，生机盎然。”,
choices: [
{ text: “完成冒险”, next: “victory”, action: () => setVictory(true) }
]
},
final_battle_direct: {
text: “你直接冲向黑暗法师，但他的黑暗魔法太强大了！你被击中，受了重伤。\n\n就在危急时刻，三件圣物突然发光，保护了你并给你力量。你重新站起，最终击败了法师！\n\n但战斗让你付出了代价。森林恢复了，但你也筋疲力尽。”,
choices: [
{ text: “完成冒险”, next: “victory”, action: () => { changeHealth(-30); setVictory(true); } }
]
},
victory: {
text: “恭喜！你成功完成了冒险！\n\n森林守护者出现在你面前，微笑着说："谢谢你，勇敢的旅行者。你拯救了这片森林。"\n\n一道光门打开，你终于可以离开这片迷雾森林了。当你走出光门，发现自己回到了熟悉的世界……但手中的光明之石提醒你，这场冒险是真实的。\n\n【游戏结束】”,
choices: [
{ text: “重新开始”, next: “start”, action: () => { setInventory([]); setHealth(100); setGameOver(false); setVictory(false); } }
]
}
};

const handleChoice = (choice) => {
if (choice.action) {
choice.action();
}

```
let nextScene = choice.next;

if (nextScene === 'bridge_gift_check') {
  if (hasItem('背包')) {
    const newInv = inventory.filter(i => i !== '背包');
    setInventory(newInv);
    nextScene = 'bridge_gift';
  } else {
    return;
  }
}

if (nextScene === 'deep_forest') {
  nextScene = hasItem('光明之石') ? 'deep_forest_light' : 'deep_forest_dark';
}

if (nextScene === 'temple_fight_check') {
  if (hasItem('木棍')) {
    const newInv = inventory.filter(i => i !== '木棍');
    setInventory(newInv);
    nextScene = 'temple_fight';
  } else {
    return;
  }
}

if (nextScene === 'temple_heal_check') {
  if (hasItem('治疗药水')) {
    const newInv = inventory.filter(i => i !== '治疗药水');
    setInventory(newInv);
    changeHealth(-30);
    nextScene = 'temple_heal';
  } else {
    return;
  }
}

if (nextScene === 'wolf_fight_check') {
  nextScene = hasItem('木棍') ? 'wolf_fight_stick' : 'wolf_fight_bare';
}

if (nextScene === 'after_temple') {
  nextScene = hasItem('勇气徽章') ? 'mist_tower' : 'hilltop';
}

if (nextScene === 'after_wolf') {
  nextScene = hasItem('智慧卷轴') ? 'mist_tower' : 'deep_forest';
}

if (nextScene === 'final_battle_check') {
  nextScene = hasItem('金色钥匙') ? 'final_battle_key' : 'final_battle';
}

setCurrentScene(nextScene);
```

};

if (gameOver) {
return (
<div className="min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 text-white p-8 flex items-center justify-center">
<div className="max-w-2xl bg-red-900/30 border-2 border-red-500 rounded-lg p-8 text-center">
<h2 className="text-3xl font-bold mb-4">游戏结束</h2>
<p className="text-xl mb-6">你的生命值降为零。森林吞噬了你……</p>
<button
onClick={() => {
setCurrentScene(‘start’);
setInventory([]);
setHealth(100);
setGameOver(false);
setVictory(false);
}}
className=“px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition”
>
重新开始
</button>
</div>
</div>
);
}

const scene = scenes[currentScene];

return (
<div className="min-h-screen bg-gradient-to-b from-indigo-900 via-purple-900 to-gray-900 text-white p-4 md:p-8">
<div className="max-w-4xl mx-auto">
<div className="text-center mb-6">
<h1 className="text-4xl font-bold mb-2 flex items-center justify-center gap-2">
<Sparkles className="text-yellow-400" />
迷雾森林冒险
<Sparkles className="text-yellow-400" />
</h1>
<p className="text-gray-300">一场关于勇气与智慧的旅程</p>
</div>

```
    <div className="bg-gray-800/50 rounded-lg p-4 mb-6 flex flex-wrap gap-4 justify-between items-center">
      <div className="flex items-center gap-2">
        <Heart className="text-red-500" />
        <div className="flex items-center gap-2">
          <span className="font-semibold">生命值:</span>
          <div className="w-32 h-4 bg-gray-700 rounded-full overflow-hidden">
            <div 
              className={`h-full transition-all ${health > 60 ? 'bg-green-500' : health > 30 ? 'bg-yellow-500' : 'bg-red-500'}`}
              style={{ width: `${health}%` }}
            />
          </div>
          <span>{health}/100</span>
        </div>
      </div>
      
      <div className="flex items-center gap-2">
        <Backpack className="text-blue-400" />
        <span className="font-semibold">背包:</span>
        <span className="text-gray-300">
          {inventory.length === 0 ? '空' : inventory.join(', ')}
        </span>
      </div>
    </div>

    <div className="bg-gray-800/70 rounded-lg p-6 mb-6 min-h-[200px]">
      <p className="text-lg leading-relaxed whitespace-pre-line">{scene.text}</p>
    </div>

    <div className="space-y-3">
      {scene.choices.map((choice, index) => {
        let isDisabled = choice.disabled;
        let displayText = choice.text;
        
        if (currentScene === 'stone_bridge' && index === 1) {
          isDisabled = !hasItem('背包');
          displayText = hasItem('背包') ? '把背包给他' : '把背包给他（你没有背包）';
        }
        
        if (currentScene === 'temple' && index === 2) {
          isDisabled = !hasItem('木棍');
          displayText = hasItem('木棍') ? '用木棍攻击石像' : '用木棍攻击石像（你没有木棍）';
        }
        
        if (currentScene === 'temple_wrong' && index === 0) {
          isDisabled = !hasItem('治疗药水');
          displayText = hasItem('治疗药水') ? '使用治疗药水' : '使用治疗药水（你没有药水）';
        }
        
        if (currentScene === 'hilltop' && index === 0) {
          displayText = hasItem('木棍') ? '用木棍战斗' : '徒手战斗';
        }
        
        if (currentScene === 'mist_tower' && index === 0) {
          displayText = hasItem('金色钥匙') ? '用智慧卷轴和金色钥匙' : '用智慧卷轴削弱他的力量';
        }
        
        return (
          <button
            key={index}
            onClick={() => handleChoice(choice)}
            disabled={isDisabled}
            className={`w-full p-4 rounded-lg font-semibold transition transform hover:scale-105 text-left ${
              isDisabled
                ? 'bg-gray-700 text-gray-500 cursor-not-allowed'
                : 'bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 shadow-lg'
            }`}
          >
            <span className="text-yellow-400 mr-2">▸</span>
            {displayText}
          </button>
        );
      })}
    </div>

    {victory && (
      <div className="mt-6 text-center text-yellow-400 animate-pulse">
        ⭐ 恭喜通关！你是真正的英雄！⭐
      </div>
    )}
  </div>
</div>
```

);
};

export default TextAdventureGame;